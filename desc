Плагин Akakul Booking предназначен для системы бронирования товаров (билетов) на сайте детского лагеря. Он добавляет функциональность бронирования с подтверждением по email, управлением бронями через админ-панель и интеграцией с WooCommerce.

Основные компоненты плагина
1. Главный файл плагина (akakul-booking.php)
Это основной файл, который регистрирует плагин в WordPress и инициализирует все его компоненты.

Ключевые функции:
Регистрация стилей и скриптов:
akakul_booking_admin_enqueue_styles() - подключает CSS для админ-панели
akakul_booking_frontend_enqueue_styles() - подключает CSS для фронтенда
akakul_booking_enqueue_scripts() - подключает JavaScript и библиотеку jQuery Mask Plugin для маски ввода телефона

Работа с базой данных:
create_booking_table() - создает таблицу woocommerce_bookings при активации плагина
delete_booking_table() - удаляет таблицу при удалении плагина

Cron-задачи:
akakul_booking_schedule_cron() - планирует задачу проверки неподтвержденных бронирований
akakul_booking_check_unconfirmed_bookings_handler() - обработчик Cron, который проверяет бронирования старше 1 часа и возвращает товары на склад
akakul_booking_clear_cron() - удаляет задачу Cron при деактивации плагина

2. Класс WooCommerce_Booking_Frontend (class-akakul-booking-frontend.php)
Обрабатывает фронтенд-часть плагина - отображение кнопки бронирования и формы.

Основные методы:
add_booking_button() - добавляет кнопку "Забронировать" рядом с кнопкой "Купить" в WooCommerce
render_booking_page() - отображает страницу бронирования через шорткод [woocommerce_booking_page]
handle_booking_request() - обрабатывает отправку формы бронирования:

Проверяет наличие товара
Валидирует данные (ФИО, email, телефон)
Уменьшает количество товара на складе
Сохраняет бронирование в БД
Отправляет email с подтверждением
  
handle_booking_confirmation() - обрабатывает подтверждение бронирования по ссылке из email
generate_booking_token() - генерирует уникальный токен для подтверждения бронирования

3. Класс WooCommerce_Booking_Admin (class-akakul-booking-admin.php)
Обеспечивает функциональность админ-панели для управления бронированиями.

Основные методы:
add_booking_admin_page() - добавляет страницу бронирований в меню админ-панели
add_sql_query_page() - добавляет страницу для выполнения SQL-запросов (для админов)
render_booking_admin_page() - отображает список бронирований с фильтрами и пагинацией
handle_delete_booking() - обрабатывает удаление бронирования (возвращает товар на склад)
handle_export_excel() - экспортирует бронирования в Excel
render_sql_query_page() - отображает интерфейс для выполнения SQL-запросов

4. Класс WooCommerce_Booking_Manual (class-akakul-booking-manual.php)
Позволяет администраторам создавать бронирования вручную.

Основные методы:
add_admin_booking_page() - добавляет страницу ручного бронирования
render_admin_booking_page() - отображает форму для ручного бронирования
handle_admin_booking_request() - обрабатывает ручное бронирование (автоматически подтверждает его)
generate_booking_token() - генерирует токен подтверждения (аналогично фронтенд-классу)

Работа с базой данных
Плагин создает таблицу wp_woocommerce_bookings со следующей структурой:

sql
Copy
CREATE TABLE wp_woocommerce_bookings (
    id mediumint(9) NOT NULL AUTO_INCREMENT,
    product_id mediumint(9) NOT NULL,
    product_name varchar(255) NOT NULL,
    parent_name varchar(255) NOT NULL,
    child_name varchar(255) NOT NULL,
    email varchar(255) NOT NULL,
    phone varchar(50) NOT NULL,
    child_bdate varchar(50) NOT NULL,
    booking_date datetime DEFAULT CURRENT_TIMESTAMP NOT NULL,
    confirmation_token varchar(64) DEFAULT NULL,
    is_confirmed tinyint(1) DEFAULT 0,
    PRIMARY KEY (id)
)
Процесс бронирования
Пользователь нажимает кнопку "Забронировать" на странице товара

Переходит на страницу бронирования с формой:
ФИО родителя
ФИО ребенка
Дата рождения ребенка
Email
Телефон
  
После отправки формы:
Товар резервируется (уменьшается количество на складе)
Запись создается в БД
На email отправляется ссылка для подтверждения
Пользователь подтверждает бронирование по ссылке из email
Если бронирование не подтверждено в течение 24 часов - оно автоматически отменяется (товар возвращается на склад)

Особенности реализации
Интеграция с WooCommerce:
Использует стандартные механизмы WooCommerce для работы с товарами
Управляет количеством товаров на складе при бронировании

Безопасность:
Использует nonce для защиты форм
Валидация всех входящих данных
Проверка прав доступа в админ-панели

Удобство администрирования:
Фильтрация и сортировка бронирований
Возможность ручного подтверждения/отмены
Экспорт в Excel
Инструмент для SQL-запросов (для админов)

Пользовательский интерфейс:
Модальное окно с подтверждением бронирования
Валидация формы на стороне клиента
Маска для ввода телефона
Плагин предоставляет комплексное решение для бронирования товаров с учетом специфики детского лагеря (необходимость указания данных ребенка и родителя, подтверждение бронирования и т.д.).
